<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FinFit - Electronics Website Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/static/lib/animate/animate.min.css" rel="stylesheet">
    <link href="/static/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">


    <!-- Customized Bootstrap Stylesheet -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="/static/css/style.css" rel="stylesheet">
    <style>
        /* Sticky Main Header */
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 999;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
        }

        /* Add padding to body to account for fixed header and navbar */
        body {
            padding-top: 200px;
        }

        /* Fixed Navigation Bar */
        .nav-bar {
            position: fixed;
            top: 105px;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 998;
        }

        /* Force consistent image sizes in product cards */
        .product-item-inner-item img {
            height: 200px !important;
            width: 100%;
            object-fit: contain;
            padding: 10px;
        }

        /* Chatbot product images */
        .product-card img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-right: 1px solid #eee;
            padding: 5px;
        }

        /* Carousel images */
        .header-carousel-item img {
            max-height: 400px;
            object-fit: contain;
        }

        /* User Dropdown Menu Styling */
        .user-dropdown-menu {
            animation: slideDown 0.2s ease-out !important;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-dropdown-menu .dropdown-item {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .user-dropdown-menu .dropdown-item:hover {
            background-color: #f8f9fa;
            border-left-color: #0d6efd;
            padding-left: 13px;
            margin-left: 0;
        }

        .user-dropdown-menu .dropdown-item.text-danger:hover {
            background-color: #fff5f5;
            border-left-color: #dc3545;
        }

        /* User Icon Hover Effect */
        #userDropdown:hover span {
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.4) !important;
            transform: scale(1.05);
        }

        #userDropdown span {
            transition: all 0.2s ease;
        }

        /* Ensure proper display/hide of auth icons */
        #loginLink {
            display: block !important;
        }

        #userMenu {
            display: none !important;
        }

        #userMenu[style*="display: block"] {
            display: block !important;
        }

        #loginLink[style*="display: none"] {
            display: none !important;
            visibility: hidden;
            width: 0;
            height: 0;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>

    <!-- Spinner Start -->
    <div id="spinner"
        class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->



    <div class="container-fluid px-5 py-4 d-none d-lg-block sticky-header">
        <div class="row gx-0 align-items-center text-center">
            <div class="col-md-4 col-lg-3 text-center text-lg-start">
                <div class="d-inline-flex align-items-center">
                    <a href="" class="navbar-brand p-0">
                        <h1 class="display-5 text-primary m-0"><i
                                class="fas fa-shopping-bag text-secondary me-2"></i>FinFit</h1>
                        <!-- <img src="/static/img/logo.png" alt="Logo"> -->
                    </a>
                </div>
            </div>
            <div class="col-md-4 col-lg-6 text-center">
                <div class="position-relative ps-4">
                    <div class="position-relative ps-4 text-center">
                        <div class="search-bar-google d-flex align-items-center bg-white rounded-pill shadow-sm border px-3"
                            style="max-width: 600px; margin: 0 auto; height: 50px;">
                            <i class="fas fa-search text-muted me-3"></i>
                            <div id="imagePreviewContainer" class="d-none me-2 position-relative"
                                style="width: 40px; height: 40px;">
                                <img id="searchImagePreview" src="" class="rounded"
                                    style="width: 100%; height: 100%; object-fit: cover; border: 1px solid #ddd;">
                                <button type="button"
                                    class="btn btn-sm btn-danger position-absolute top-0 start-100 translate-middle rounded-circle p-0"
                                    style="width: 15px; height: 15px; font-size: 10px;" onclick="clearSearchImage()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <input id="searchInput" class="form-control border-0 bg-transparent shadow-none w-100"
                                type="text" placeholder="Search Products..."
                                onkeypress="if(event.key === 'Enter') handleSearchClick()" style="font-size: 1.1rem;">

                            <!-- Vertical Divider -->
                            <div class="border-start mx-2" style="height: 25px;"></div>

                            <!-- Voice Search Icon -->
                            <button type="button" class="btn btn-link text-muted p-2" onclick="startVoiceSearch()"
                                title="Voice Search">
                                <i id="micIcon" class="fas fa-microphone fa-lg hover-primary"></i>
                            </button>

                            <!-- Camera Icon for Image Search -->
                            <button type="button" class="btn btn-link text-muted p-2" onclick="triggerImageUpload()"
                                title="Search by Image">
                                <i class="fas fa-camera fa-lg hover-primary"></i>
                            </button>

                            <!-- Search Button -->
                            <button type="button"
                                class="btn btn-primary rounded-circle ms-2 d-flex align-items-center justify-content-center"
                                style="width: 40px; height: 40px;" onclick="handleSearchClick()">
                                <i class="fas fa-arrow-right"></i>
                            </button>

                            <!-- Hidden File Input -->
                            <input type="file" id="imageInput" class="d-none" accept="image/*"
                                onchange="handleImageSelect(event)">
                            <input type="hidden" id="searchMode" value="text">
                        </div>
                    </div>
                </div>
                <!-- Image Upload Area (Hidden by default) -->

            </div>
            <div class="col-md-4 col-lg-3 text-center text-lg-end">
                <div class="d-inline-flex align-items-center">
                    <!-- User/Login Icon -->
                    <div id="userIconContainer" class="me-3">
                        <!-- Login Link (when not authenticated) -->
                        <a href="signin.html" id="loginLink"
                            class="text-muted d-flex align-items-center justify-content-center" title="Sign In"
                            style="display: block;">
                            <span class="rounded-circle btn-md-square border"><i class="fas fa-user"></i></span>
                        </a>

                        <!-- User Menu (when authenticated) -->
                        <div id="userMenu" class="dropdown" style="display: none;">
                            <a href="#"
                                class="dropdown-toggle text-muted d-flex align-items-center justify-content-center"
                                id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="User Menu"
                                style="text-decoration: none;">
                                <span class="rounded-circle btn-md-square bg-primary text-white border-0"
                                    style="font-size: 14px; box-shadow: 0 2px 6px rgba(13, 110, 253, 0.3); transition: all 0.2s ease;">
                                    <i class="fas fa-user"></i>
                                </span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end user-dropdown-menu"
                                aria-labelledby="userDropdown"
                                style="min-width: 280px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 1px solid #e0e0e0;">
                                <li style="padding: 12px 16px; border-bottom: 1px solid #f0f0f0;">
                                    <div style="font-size: 13px; color: #999;">Logged in as</div>
                                    <div id="userNameDisplay" style="font-weight: 600; color: #333; margin-top: 4px;">
                                    </div>
                                </li>
                                <li>
                                    <hr class="dropdown-divider m-0">
                                </li>
                                <li><a class="dropdown-item" href="/" style="padding: 10px 16px;"><i class="fas fa-home"
                                            style="color: #0d6efd; margin-right: 8px; width: 16px;"></i>Home</a></li>
                                <li><a class="dropdown-item" href="cart.html" style="padding: 10px 16px;"><i
                                            class="fas fa-shopping-cart"
                                            style="color: #ffc107; margin-right: 8px; width: 16px;"></i>My Cart</a></li>
                                <li><a class="dropdown-item" href="wishlist.html" style="padding: 10px 16px;"><i
                                            class="fas fa-heart"
                                            style="color: #dc3545; margin-right: 8px; width: 16px;"></i>Favorites</a>
                                </li>
                                <li><a class="dropdown-item" href="#" style="padding: 10px 16px;"><i class="fas fa-cog"
                                            style="color: #6c757d; margin-right: 8px; width: 16px;"></i>Settings</a>
                                </li>
                                <li>
                                    <hr class="dropdown-divider m-0">
                                </li>
                                <li><a class="dropdown-item text-danger" href="#" id="logoutBtn"
                                        style="padding: 10px 16px;"><i class="fas fa-sign-out-alt"
                                            style="margin-right: 8px; width: 16px;"></i>Logout</a></li>
                            </ul>
                        </div>
                    </div>

                    <a href="wishlist.html"
                        class="text-muted d-flex align-items-center justify-content-center me-3 position-relative">
                        <span class="rounded-circle btn-md-square border"><i class="fas fa-heart"></i></span>
                        <span id="wishlistBadge"
                            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                            style="display: none;">0</span>
                    </a>
                    <a href="cart.html"
                        class="text-muted d-flex align-items-center justify-content-center position-relative">
                        <span class="rounded-circle btn-md-square border"><i class="fas fa-shopping-cart"></i></span>
                        <span id="cartBadge"
                            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                            style="display: none;">0</span>
                    </a>
                    <!-- Vider panier et favoris (visible when not logged in) -->
                </div>
            </div>
        </div>
    </div>
    <!-- Topbar End -->

    <!-- Navbar & Hero Start -->
    <div class="container-fluid nav-bar p-0">
        <div class="row gx-0 bg-primary px-5 align-items-center">
            <div class="col-lg-3 d-none d-lg-block">
                <nav class="navbar navbar-light position-relative" style="width: 250px;">
                    <div class="collapse navbar-collapse rounded-bottom" id="allCat">
                        <div class="navbar-nav ms-auto py-0">
                            <ul class="list-unstyled categories-bars">
                                <li>
                                    <div class="categories-bars-item">
                                        <a href="#tab-1" data-bs-toggle="pill"
                                            onclick="loadTab('tab-1', 'Accessories')">Accessories</a>
                                        <span>(12)</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="categories-bars-item">
                                        <a href="#tab-1" data-bs-toggle="pill"
                                            onclick="loadTab('tab-1', 'Fashion')">Fashion</a>
                                        <span>(15)</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="categories-bars-item">
                                        <a href="#tab-1" data-bs-toggle="pill"
                                            onclick="loadTab('tab-1', 'Electronics')">Electronics</a>
                                        <span>(20)</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="categories-bars-item">
                                        <a href="#tab-1" data-bs-toggle="pill"
                                            onclick="loadTab('tab-1', 'Decoration')">Decoration</a>
                                        <span>(10)</span>
                                    </div>
                                </li>
                                <li>
                                    <div class="categories-bars-item">
                                        <a href="#tab-1" data-bs-toggle="pill"
                                            onclick="loadTab('tab-1', 'Mobiles')">Mobiles</a>
                                        <span>(8)</span>
                                    </div>
                                </li>
                            </ul>

                        </div>

                    </div>
                </nav>
            </div>
            <div class="col-12 col-lg-9">
                <nav class="navbar navbar-expand-lg navbar-light bg-primary ">
                    <a href="" class="navbar-brand d-block d-lg-none">
                        <h1 class="display-5 text-secondary m-0"><i
                                class="fas fa-shopping-bag text-white me-2"></i>FinFit</h1>
                        <!-- <img src="/static/img/logo.png" alt="Logo"> -->
                    </a>
                    <button class="navbar-toggler ms-auto" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarCollapse">
                        <span class="fa fa-bars fa-1x"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarCollapse">
                        <div class="navbar-nav ms-auto py-0">
                            <a href="index.html" class="nav-item nav-link active">Home</a>
                            <a href="shop.html" class="nav-item nav-link">Shop</a>
                            <a href="contact.html" class="nav-item nav-link me-2">Contact</a>
                            <div class="nav-item dropdown d-block d-lg-none mb-3">
                                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">All Category</a>
                                <div class="dropdown-menu m-0">
                                    <ul class="list-unstyled categories-bars">
                                        <li>
                                            <div class="categories-bars-item">
                                                <a href="#">Accessories</a>
                                                <span>(3)</span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="categories-bars-item">
                                                <a href="#">Electronics & Computer</a>
                                                <span>(5)</span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="categories-bars-item">
                                                <a href="#">Laptops & Desktops</a>
                                                <span>(2)</span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="categories-bars-item">
                                                <a href="#">Mobiles & Tablets</a>
                                                <span>(8)</span>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="categories-bars-item">
                                                <a href="#">SmartPhone & Smart TV</a>
                                                <span>(5)</span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </div>
    <!-- Navbar & Hero End -->

    <!-- Carousel Start -->
    <div class="container-fluid carousel bg-light px-0">
        <div class="row g-0 justify-content-end">
            <div class="col-12 col-lg-7 col-xl-9">
                <div class="header-carousel owl-carousel bg-light py-5" id="headerCarousel">
                    <!-- 2 random products loaded from Qdrant Cloud -->
                    <div class="row g-0 header-carousel-item align-items-center">
                        <div class="col-12 text-center py-5">
                            <div class="spinner-border text-primary" role="status"></div>
                            <p class="mt-2 text-muted">Chargement des produits...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-5 col-xl-3 wow fadeInRight" data-wow-delay="0.1s">
                <div class="carousel-header-banner h-100">
                    <img src="/static/img/header-img.jpg" class="img-fluid w-100 h-100" style="object-fit: cover;"
                        alt="Image">
                    <div class="carousel-banner-offer">
                        <p class="bg-primary text-white rounded fs-5 py-2 px-4 mb-0 me-3">Save $48.00</p>
                        <p class="text-primary fs-5 fw-bold mb-0">Special Offer</p>
                    </div>
                    <div class="carousel-banner">
                        <div class="carousel-banner-content text-center p-4">
                            <a href="#" class="d-block mb-2">SmartPhone</a>
                            <a href="#" class="d-block text-white fs-3">Apple iPad Mini <br> G2356</a>
                            <del class="me-2 text-white fs-5">$1,250.00</del>
                            <span class="text-primary fs-5">$1,050.00</span>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Carousel End -->

    <!-- All Products Start (default: Pour vous) -->
    <div class="container-fluid product py-5">
        <div class="container py-5">
            <div class="tab-class">
                <div class="row g-4">
                    <div class="col-lg-4 text-start wow fadeInLeft" data-wow-delay="0.1s">
                        <h1>All Products</h1>
                        <p class="text-muted">Pour vous : recommandations basées sur vos favoris, panier et recherche (données enregistrées ici).</p>
                    </div>
                    <div class="col-lg-8 text-end wow fadeInRight" data-wow-delay="0.1s">
                        <ul class="nav nav-pills d-inline-flex text-center mb-5">
                            <li class="nav-item mb-4">
                                <a class="d-flex mx-2 py-2 bg-light rounded-pill active" data-bs-toggle="pill"
                                    href="#tab-0" onclick="loadTab('tab-0', 'pour-vous')">
                                    <span class="text-dark" style="width: 130px;"><i class="fas fa-heart me-1"></i> Pour vous</span>
                                </a>
                            </li>
                            <li class="nav-item mb-4">
                                <a class="d-flex mx-2 py-2 bg-light rounded-pill" data-bs-toggle="pill"
                                    href="#tab-1" onclick="loadTab('tab-1', null)">
                                    <span class="text-dark" style="width: 130px;">All Products</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="tab-content">
                    <!-- Tab 0: Pour vous (recommandations personnalisées, pas de filtres manuels) -->
                    <div id="tab-0" class="tab-pane fade show p-0 active">
                        <div id="loadingSpinner-0" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Chargement de vos recommandations (favoris, panier, recherche)…</p>
                        </div>
                        <div id="pourVousBanner" class="mb-4" style="display: none;"></div>
                        <div id="resultsGrid-0" class="row g-4">
                            <!-- Pour vous: recommandations basées sur favoris, panier, recherche -->
                        </div>
                    </div>
                    <!-- Tab 1: All Products -->
                    <div id="tab-1" class="tab-pane fade p-0">
                        <div id="loadingSpinner-1" class="text-center py-5" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Chargement des produits depuis Qdrant Cloud...</p>
                        </div>
                        <div id="aiAnswerContainer-1" class="mb-4 d-none">
                            <div class="bg-primary bg-opacity-10 rounded p-4 border border-primary border-opacity-25">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bg-primary rounded-circle p-2 me-2">
                                        <i class="fas fa-robot text-white"></i>
                                    </div>
                                    <h5 class="mb-0 text-primary">AI Shopping Assistant</h5>
                                </div>
                                <div id="aiAnswerText-1" class="text-dark lead"></div>
                            </div>
                        </div>
                        <div id="resultsGrid-1" class="row g-4">
                            <!-- Products loaded dynamically from Qdrant -->
                        </div>
                    </div>
                    <!-- Tab 2: Electronics -->
                    <div id="tab-2" class="tab-pane fade p-0" role="tabpanel">
                        <div id="loadingSpinner-2" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Loading Electronics...</p>
                        </div>
                        <div id="resultsGrid-2" class="row g-4">
                            <!-- Electronics loaded dynamically from Qdrant -->
                        </div>
                    </div>
                    <!-- Tab 3: Fashion -->
                    <div id="tab-3" class="tab-pane fade p-0" role="tabpanel">
                        <div id="loadingSpinner-3" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Loading Fashion...</p>
                        </div>
                        <div id="resultsGrid-3" class="row g-4">
                            <!-- Fashion loaded dynamically from Qdrant -->
                        </div>
                    </div>
                    <!-- Tab 4: Decoration -->
                    <div id="tab-4" class="tab-pane fade p-0">
                        <div id="loadingSpinner-4" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Loading Decoration...</p>
                        </div>
                        <div id="resultsGrid-4" class="row g-4">
                            <!-- Decoration loaded dynamically from Qdrant -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Our Products End -->

    <!-- Recommandations Personnalisées Start -->
    <div class="container-fluid bg-light py-5" id="recommendationsSection" style="display: none;">
        <div class="container py-5">
            <div class="mx-auto text-center mb-5" style="max-width: 900px;">
                <h4 class="text-primary border-bottom border-primary border-2 d-inline-block p-2 title-border-radius wow fadeInUp" data-wow-delay="0.1s"><i class="fas fa-magic me-2"></i>Recommandé pour vous</h4>
                <h1 class="mb-0 display-5 wow fadeInUp" data-wow-delay="0.3s">Recommandations Personnalisées</h1>
                <p class="text-muted mt-3" id="recommendationStrategy">Basé sur vos intérêts et préférences</p>
            </div>
            <div id="recommendationsLoading" class="text-center py-5">
                <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>
                <p class="mt-2 text-muted">Analyse de vos préférences...</p>
            </div>
            <div id="recommendationsGrid" class="row g-4" style="display: none;"></div>
            <div id="noRecommendations" class="text-center py-5" style="display: none;"></div>
            <div id="aiAnswerContainer-recommendations" class="alert alert-info mt-3 d-none" role="alert">
                <i class="fas fa-robot me-2"></i><span id="aiAnswerText-recommendations"></span>
            </div>
        </div>
    </div>
    <!-- Recommandations Personnalisées End -->

    <!-- Product Banner Start -->
    <div class="container-fluid py-5">
        <div class="container">
            <div class="row g-4" id="bannerContainer">
                <div class="col-lg-6 wow fadeInLeft" data-wow-delay="0.1s">
                    <a href="#">
                        <div class="bg-primary rounded position-relative">
                            <img src="/static/img/product-banner.jpg" class="img-fluid w-100 rounded" alt="">
                            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center rounded p-4"
                                style="background: rgba(255, 255, 255, 0.5);">
                                <h3 class="display-5 text-primary">EOS Rebel <br> <span>T7i Kit</span></h3>
                                <p class="fs-4 text-muted">$899.99</p>
                                <a href="#" class="btn btn-primary rounded-pill align-self-start py-2 px-4">Shop Now</a>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-lg-6 wow fadeInRight" data-wow-delay="0.2s">
                    <a href="#">
                        <div class="text-center bg-primary rounded position-relative">
                            <img src="/static/img/product-banner-2.jpg" class="img-fluid w-100" alt="">
                            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center rounded p-4"
                                style="background: rgba(242, 139, 0, 0.5);">
                                <h2 class="display-2 text-secondary">SALE</h2>
                                <h4 class="display-5 text-white mb-4">Get UP To 50% Off</h4>
                                <a href="#" class="btn btn-secondary rounded-pill align-self-center py-2 px-4">Shop
                                    Now</a>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Product Banner End -->

    <!-- Product List Satrt -->
    <div class="container-fluid products productList overflow-hidden">
        <div class="container products-mini py-5">
            <div class="mx-auto text-center mb-5" style="max-width: 900px;">
                <h4 class="text-primary border-bottom border-primary border-2 d-inline-block p-2 title-border-radius wow fadeInUp"
                    data-wow-delay="0.1s">Products</h4>
                <h1 class="mb-0 display-3 wow fadeInUp" data-wow-delay="0.3s">All Product Items</h1>
            </div>
            <div class="productList-carousel owl-carousel pt-4 wow fadeInUp" data-wow-delay="0.3s"
                id="productListCarousel">
                <div class="productImg-carousel owl-carousel productList-item">
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-4.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-4.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-6.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-7.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="productImg-carousel owl-carousel productList-item">
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-8.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-9.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-10.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-11.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="productImg-carousel owl-carousel productList-item">
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-12.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-13.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-14.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-15.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="productImg-carousel owl-carousel productList-item">
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-16.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-17.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="productImg-item products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-3.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Product List End -->

    <!-- Bestseller Products Start -->
    <div class="container-fluid products pb-5">
        <div class="container products-mini py-5">
            <div class="mx-auto text-center mb-5" style="max-width: 700px;">
                <h4 class="text-primary mb-4 border-bottom border-primary border-2 d-inline-block p-2 title-border-radius wow fadeInUp"
                    data-wow-delay="0.1s">Bestseller Products</h4>
                <p class="mb-0 wow fadeInUp" data-wow-delay="0.2s">Lorem ipsum dolor sit amet consectetur adipisicing
                    elit. Modi, asperiores ducimus sint quos tempore officia similique quia? Libero, pariatur
                    consectetur?</p>
            </div>
            <div class="row g-4" id="bestsellersContainer">
                <div class="col-md-6 col-lg-6 col-xl-4 wow fadeInUp" data-wow-delay="0.1s">
                    <div class="products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-3.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-4 wow fadeInUp" data-wow-delay="0.3s">
                    <div class="products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-4.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-4 wow fadeInUp" data-wow-delay="0.5s">
                    <div class="products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-5.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-4 wow fadeInUp" data-wow-delay="0.1s">
                    <div class="products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-6.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-4 wow fadeInUp" data-wow-delay="0.3s">
                    <div class="products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-7.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-4 wow fadeInUp" data-wow-delay="0.5s">
                    <div class="products-mini-item border">
                        <div class="row g-0">
                            <div class="col-5">
                                <div class="products-mini-img border-end h-100">
                                    <img src="/static/img/product-11.png" class="img-fluid w-100 h-100" alt="Image">
                                    <div class="products-mini-icon rounded-circle bg-primary">
                                        <a href="#"><i class="fa fa-eye fa-1x text-white"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-7">
                                <div class="products-mini-content p-3">
                                    <a href="#" class="d-block mb-2">SmartPhone</a>
                                    <a href="#" class="d-block h4">Apple iPad Mini <br> G2356</a>
                                    <del class="me-2 fs-5">$1,250.00</del>
                                    <span class="text-primary fs-5">$1,050.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="products-mini-add border p-3">
                            <a href="#" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                    class="fas fa-shopping-cart me-2"></i> Add To Cart</a>
                            <div class="d-flex">
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-3"><span
                                        class="rounded-circle btn-sm-square border"><i
                                            class="fas fa-random"></i></i></a>
                                <a href="#"
                                    class="text-primary d-flex align-items-center justify-content-center me-0"><span
                                        class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Bestseller Products End -->


    <!-- Footer Start -->
    <div class="container-fluid footer py-5 wow fadeIn" data-wow-delay="0.2s">
        <div class="container py-5">
            <div class="row g-4 rounded mb-5" style="background: rgba(255, 255, 255, .03);">
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="rounded p-4">
                        <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-4"
                            style="width: 70px; height: 70px;">
                            <i class="fas fa-map-marker-alt fa-2x text-primary"></i>
                        </div>
                        <div>
                            <h4 class="text-white">Address</h4>
                            <p class="mb-2">Hammam L'inf, Ben Arous, Tunisia</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="rounded p-4">
                        <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-4"
                            style="width: 70px; height: 70px;">
                            <i class="fas fa-envelope fa-2x text-primary"></i>
                        </div>
                        <div>
                            <h4 class="text-white">Mail Us</h4>
                            <p class="mb-2">karim.mlayah@nexus.tn</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="rounded p-4">
                        <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-4"
                            style="width: 70px; height: 70px;">
                            <i class="fa fa-phone-alt fa-2x text-primary"></i>
                        </div>
                        <div>
                            <h4 class="text-white">Telephone</h4>
                            <p class="mb-2">(+216) 24 567 890</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="rounded p-4">
                        <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-4"
                            style="width: 70px; height: 70px;">
                            <i class="fab fa-firefox-browser fa-2x text-primary"></i>
                        </div>
                        <div>
                            <h4 class="text-white">Website</h4>
                            <p class="mb-2">nexus-ecommerce.tn</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-5">
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item d-flex flex-column">
                        <div class="footer-item">
                            <h4 class="text-primary mb-4">Newsletter</h4>
                            <p class="mb-3">Abonnez-vous pour recevoir les dernières offres et nouveautés de notre
                                boutique propulsée par Qdrant Cloud.</p>
                            <div class="position-relative mx-auto rounded-pill">
                                <input class="form-control rounded-pill w-100 py-3 ps-4 pe-5" type="text"
                                    placeholder="Enter your email">
                                <button type="button"
                                    class="btn btn-primary rounded-pill position-absolute top-0 end-0 py-2 mt-2 me-2">SignUp</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item d-flex flex-column">
                        <h4 class="text-primary mb-4">Customer Service</h4>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Contact Us</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Returns</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Order History</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Site Map</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item d-flex flex-column">
                        <h4 class="text-primary mb-4">Information</h4>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> About Us</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Delivery infomation</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Privacy Policy</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Terms & Conditions</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item d-flex flex-column">
                        <h4 class="text-primary mb-4">Account</h4>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> My Account</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Wishlist</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Track Your Order</a>
                        <a href="#"><i class="fas fa-angle-right me-2"></i> Shop</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <!-- Copyright Start -->
    <div class="container-fluid copyright py-4">
        <div class="container">
            <div class="row g-4 align-items-center">
                <div class="col-md-6 text-center text-md-start mb-md-0">
                    <span class="text-white"><a href="#" class="border-bottom text-white"><i
                                class="fas fa-copyright text-light me-2"></i>Hackathon Nexus</a>, All right
                        reserved.</span>
                </div>
                <div class="col-md-6 text-center text-md-end text-white">
                    Designed By <a class="border-bottom text-white" href="https://htmlcodex.com">HTML Codex</a>
                </div>
            </div>
        </div>
    </div>
    <!-- Copyright End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary btn-lg-square back-to-top"><i class="fa fa-arrow-up"></i></a>

    <!-- AI Chatbot UI -->
    <div class="ai-chatbot-btn" onclick="toggleChat()" title="Ask our AI Assistant">
        <i class="fas fa-robot"></i>
    </div>

    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <div class="d-flex align-items-center">
                <i class="fas fa-robot me-2"></i>
                <h5>FinFit AI Assistant</h5>
            </div>
            <div class="close-chat" onclick="toggleChat()">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="chat-message message-ai">
                Hello! I'm your FinFit assistant. How can I help you find the best electronics today?
            </div>
        </div>
        <div class="chat-footer">
            <!-- Image Preview Area -->
            <div id="chatImagePreviewContainer" class="d-none mb-2 p-2 bg-light rounded position-relative">
                <img id="chatImagePreview" src="" class="rounded"
                    style="max-height: 80px; max-width: 100px; object-fit: contain;">
                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1"
                    onclick="clearChatImage()" style="padding: 2px 6px; font-size: 10px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-input-group">
                <button class="btn btn-link text-muted p-2" onclick="document.getElementById('chatImageInput').click()"
                    title="Upload Image">
                    <i class="fas fa-camera"></i>
                </button>
                <input type="file" id="chatImageInput" class="d-none" accept="image/*"
                    onchange="handleChatImageSelect(event)">
                <input type="text" id="chatInput" placeholder="Ask me anything..."
                    onkeypress="if(event.key === 'Enter') sendChatMessage()">
                <button class="send-btn" onclick="sendChatMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>


    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/lib/wow/wow.min.js"></script>
    <script src="/static/lib/owlcarousel/owl.carousel.min.js"></script>


    <!-- Template Javascript -->
    <script src="/static/js/main.js"></script>
    <script src="/static/js/recommendations.js"></script>

    <!-- Auth Script -->
    <script>
        // Check authentication status and update UI
        function updateAuthUI() {
            try {
                const token = localStorage.getItem('finfit_token');
                const userJson = localStorage.getItem('finfit_user');
                const user = userJson ? JSON.parse(userJson) : null;

                const loginLink = document.getElementById('loginLink');
                const userMenu = document.getElementById('userMenu');
                const userNameDisplay = document.getElementById('userNameDisplay');
                const logoutBtn = document.getElementById('logoutBtn');

                if (token && user) {
                    // User is logged in - show user menu, hide login link
                    if (loginLink) {
                        loginLink.style.visibility = 'hidden';
                        loginLink.style.width = '0';
                        loginLink.style.height = '0';
                        loginLink.style.display = 'none';
                        loginLink.classList.add('d-none');
                    }
                    if (userMenu) {
                        userMenu.style.display = 'block';
                        userMenu.classList.remove('d-none');
                    }
                    var clearLink = document.getElementById('clearGuestDataLink');
                    if (clearLink) { clearLink.classList.add('d-none'); }
                    if (userNameDisplay) userNameDisplay.textContent = user.name + ' (' + user.email + ')';

                    if (logoutBtn) {
                        logoutBtn.onclick = function (e) {
                            e.preventDefault();
                            logout();
                            return false;
                        };
                    }
                } else {
                    // User is not logged in - show login link, hide user menu, show "Vider" link
                    if (loginLink) {
                        loginLink.style.visibility = 'visible';
                        loginLink.style.width = 'auto';
                        loginLink.style.height = 'auto';
                        loginLink.style.display = 'block';
                        loginLink.classList.remove('d-none');
                    }
                    if (userMenu) {
                        userMenu.style.display = 'none';
                        userMenu.classList.add('d-none');
                    }
                    var clearLink = document.getElementById('clearGuestDataLink');
                    if (clearLink) { clearLink.classList.remove('d-none'); }
                }
            } catch (error) {
                console.error('Error updating auth UI:', error);
            }
        }

        function logout() {
            localStorage.removeItem('finfit_token');
            localStorage.removeItem('finfit_user');
            location.reload();
        }

        // Initialize auth UI when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', updateAuthUI);
        } else {
            updateAuthUI();
        }

        // Also update on page visibility changes
        document.addEventListener('visibilitychange', function () {
            if (!document.hidden) {
                updateAuthUI();
            }
        });
    </script>

    <!-- Integration Script -->
    <script>
        const API_BASE = (window.location.protocol === 'file:')
            ? 'http://localhost:8000'
            : window.location.origin;
        let selectedImageBase64 = null; // For main search
        let selectedChatImageBase64 = null; // For chat

        function triggerImageUpload() {
            document.getElementById('imageInput').click();
        }

        function handleChatImageSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    selectedChatImageBase64 = e.target.result; // Store base64 string
                    const preview = document.getElementById('chatImagePreview');
                    const previewContainer = document.getElementById('chatImagePreviewContainer');
                    preview.src = selectedChatImageBase64;
                    previewContainer.classList.remove('d-none');
                };
                reader.readAsDataURL(file);
            }
        }

        function clearChatImage() {
            selectedChatImageBase64 = null;
            document.getElementById('chatImagePreview').src = '';
            document.getElementById('chatImagePreviewContainer').classList.add('d-none');
            document.getElementById('chatImageInput').value = ''; // Clear the file input
        }

        // Voice Search Implementation
        function startVoiceSearch() {
            if (!('webkitSpeechRecognition' in window)) {
                alert("Voice search is not supported in this browser. Please use Chrome.");
                return;
            }

            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'en-US'; // Default to English, could be dynamic
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            const micIcon = document.getElementById('micIcon');
            micIcon.classList.remove('fa-microphone');
            micIcon.classList.add('fa-microphone-slash', 'text-danger');

            recognition.start();

            recognition.onresult = function (event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('searchInput').value = transcript;
                handleSearchClick(); // Trigger search automatically
            };

            recognition.onerror = function (event) {
                console.error('Voice search error:', event.error);
                alert('Voice search failed. Please try again.');
            };

            recognition.onend = function () {
                micIcon.classList.remove('fa-microphone-slash', 'text-danger');
                micIcon.classList.add('fa-microphone');
            };
        }

        // --- Cart & Wishlist Logic (per-account keys so badge matches cart page) ---
        function getCartKey() {
            try {
                var u = localStorage.getItem('finfit_user');
                if (u) { var o = JSON.parse(u); if (o && o.email) return 'finfit_cart_' + String(o.email); }
            } catch (e) {}
            return 'finfit_cart';
        }
        function getWishlistKey() {
            try {
                var u = localStorage.getItem('finfit_user');
                if (u) { var o = JSON.parse(u); if (o && o.email) return 'finfit_wishlist_' + String(o.email); }
            } catch (e) {}
            return 'finfit_wishlist';
        }
        /** Key for recommendation seed history (all products ever liked or added to cart). */
        function getRecommendationHistoryKey() {
            try {
                var u = localStorage.getItem('finfit_user');
                if (u) { var o = JSON.parse(u); if (o && o.email) return 'finfit_seed_history_' + String(o.email); }
            } catch (e) {}
            return 'finfit_seed_history';
        }
        /** Append product id to recommendation history (max 50 unique, most recent first). */
        function appendToRecommendationHistory(productId) {
            var id = (productId != null && productId !== '') ? String(productId) : '';
            if (!id) return;
            var key = getRecommendationHistoryKey();
            var arr = JSON.parse(localStorage.getItem(key) || '[]');
            arr = arr.filter(function (x) { return x !== id; });
            arr.unshift(id);
            if (arr.length > 50) arr = arr.slice(0, 50);
            localStorage.setItem(key, JSON.stringify(arr));
        }
        let cart = JSON.parse(localStorage.getItem(getCartKey()) || 'null') || [];
        let wishlist = JSON.parse(localStorage.getItem(getWishlistKey()) || 'null') || [];
        let renderedProductsCache = []; // To store current products for easy access

        function viewProduct(index) {
            const product = renderedProductsCache[index];
            if (!product) return;

            // Track interaction
            trackInteraction('view', product.id);

            localStorage.setItem('finfit_selected_product', JSON.stringify(product));
            const id = (product.id != null && product.id !== '') ? String(product.id) : '';
            const asin = (product.asin != null && product.asin !== '') ? String(product.asin) : '';
            if (id) window.location.href = 'single.html?id=' + encodeURIComponent(id);
            else if (asin) window.location.href = 'single.html?asin=' + encodeURIComponent(asin);
            else window.location.href = 'single.html';
        }

        /** Clear current cart and wishlist from localStorage (guest or current user). */
        function clearCartAndWishlist() {
            var ck = getCartKey(), wk = getWishlistKey();
            localStorage.setItem(ck, '[]');
            localStorage.setItem(wk, '[]');
            cart.length = 0;
            wishlist.length = 0;
            updateCounters();
            if (typeof showToast === 'function') showToast('Panier et favoris vidés.');
        }

        function updateCounters() {
            var cartData = JSON.parse(localStorage.getItem(getCartKey()) || 'null') || [];
            var wishlistData = JSON.parse(localStorage.getItem(getWishlistKey()) || 'null') || [];
            cart.length = 0; cart.push.apply(cart, cartData);
            wishlist.length = 0; wishlist.push.apply(wishlist, wishlistData);
            const wishlistBadge = document.getElementById('wishlistBadge');
            const cartBadge = document.getElementById('cartBadge');
            const cartTotal = document.getElementById('cartTotal');

            if (wishlistBadge) {
                if (wishlistData.length > 0) {
                    wishlistBadge.textContent = wishlistData.length;
                    wishlistBadge.style.display = 'block';
                } else {
                    wishlistBadge.style.display = 'none';
                }
            }
            if (cartBadge || cartTotal) {
                const totalCount = cartData.reduce((sum, item) => sum + (item.quantity || 0), 0);
                const totalPrice = cartData.reduce((sum, item) => sum + ((item.price || 0) * (item.quantity || 0)), 0);
                if (cartBadge) {
                    if (totalCount > 0) {
                        cartBadge.textContent = totalCount;
                        cartBadge.style.display = 'block';
                    } else {
                        cartBadge.style.display = 'none';
                    }
                }
                if (cartTotal) cartTotal.textContent = '$' + totalPrice.toFixed(2);
            }
        }

        async function trackInteraction(type, productId) {
            const userJson = localStorage.getItem('finfit_user');
            if (!userJson) return;
            try {
                const user = JSON.parse(userJson);
                const email = user.email;
                if (!email) return;

                const headers = { 'Content-Type': 'application/json' };
                const token = localStorage.getItem('finfit_token');
                if (token) headers['Authorization'] = 'Bearer ' + token;

                fetch(`${API_BASE}/api/interactions`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        user_email: email,
                        type: type,
                        product_id: (productId != null && productId !== undefined) ? String(productId) : ''
                    })
                }).catch(function () { /* fire-and-forget */ });
            } catch (e) {
                console.error('Failed to track interaction:', e);
            }
        }

        function addToCart(index) {
            if (!checkAuth()) return;
            const product = renderedProductsCache[index];
            if (!product) return;

            trackInteraction('cart', product.id);
            appendToRecommendationHistory(product.id || product.asin);

            const existingItem = cart.find(item => item.name === product.name); // Using name as ID for now
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id || product.asin || '',
                    name: product.name,
                    price: product.price || product.final_price || 0,
                    image: product.image || (product.image_urls && product.image_urls[0]) || '/static/img/placeholder.png',
                    quantity: 1
                });
            }

            localStorage.setItem(getCartKey(), JSON.stringify(cart));
            updateCounters();
            showToast(`Added to cart: ${product.name}`);
        }

        function toggleWishlist(index) {
            if (!checkAuth()) return;
            const product = renderedProductsCache[index];
            if (!product) return;

            const existingIndex = wishlist.findIndex(item => item.name === product.name);
            if (existingIndex > -1) {
                wishlist.splice(existingIndex, 1);
                showToast(`Removed from favorites: ${product.name}`);
            } else {
                wishlist.push({
                    id: product.id || product.asin || '',
                    name: product.name,
                    price: product.price || product.final_price || 0,
                    image: product.image || (product.image_urls && product.image_urls[0]) || '/static/img/placeholder.png'
                });
                showToast(`Added to favorites: ${product.name}`);
                appendToRecommendationHistory(product.id || product.asin);
                trackInteraction('wishlist', product.id);
            }

            localStorage.setItem(getWishlistKey(), JSON.stringify(wishlist));
            updateCounters();
            updateWishlistHeartIcon(index, product);
        }

        function updateWishlistHeartIcon(index, product) {
            const grid = document.querySelector('.tab-pane.active [id^="resultsGrid"]');
            if (!grid) return;
            const cards = grid.querySelectorAll('.col-md-6.col-lg-4.col-xl-3');
            const card = cards[index];
            if (!card) return;
            const heartBtn = card.querySelector('.btn-wishlist-toggle');
            if (!heartBtn) return;
            const icon = heartBtn.querySelector('i');
            if (!icon) return;
            const isInWishlist = wishlist.some(function(w) { return w.name === (product.name || product.title); });
            icon.className = isInWishlist ? 'fas fa-heart fa-1x text-danger' : 'far fa-heart fa-1x';
            heartBtn.title = isInWishlist ? 'Retirer des favoris' : 'Ajouter aux favoris';
        }

        function showToast(message) {
            // Create a simple toast container if it doesn't exist
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 9999;';
                document.body.appendChild(container);
            }

            const toast = document.createElement('div');
            toast.className = 'toast show align-items-center text-white bg-primary border-0 mb-2';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;

            container.appendChild(toast);

            // Auto remove
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize counters on load
        document.addEventListener('DOMContentLoaded', () => {
            updateCounters();
            updateCurrency(); // Initialize currency on load

            // Load initial content
            loadTab('tab-1', null);  // Load all products initially
            loadHeaderCarousel();     // Load carousel
            loadProductListCarousel(); // Load product list carousel
            loadFeaturedOffers();     // Load featured offers
            loadDynamicBanners();     // Load banners
            loadBestsellers();        // Load bestsellers
            loadCarouselProducts();   // Load carousel products
        });

        // --- Currency Converter Logic ---
        const exchangeRates = {
            'USD': 1,
            'EUR': 0.92,
            'TND': 3.1
        };

        const currencySymbols = {
            'USD': '$',
            'EUR': '€',
            'TND': 'DT'
        };

        function updateCurrency() {
            const currency = document.getElementById('currencySelector').value;
            const rate = exchangeRates[currency];
            const symbol = currencySymbols[currency];

            // 1. Update all price elements in the DOM
            document.querySelectorAll('.text-primary.fs-5.fw-bold, .product-price, .fs-4.text-muted, .fs-4.text-white').forEach(el => {
                // Store original USD price if not already stored
                if (!el.dataset.usdPrice) {
                    // Try to extract number from text
                    const match = el.textContent.match(/[\d\.,]+/);
                    if (match) {
                        el.dataset.usdPrice = parseFloat(match[0].replace(/,/g, ''));
                    }
                }

                if (el.dataset.usdPrice) {
                    const usdPrice = parseFloat(el.dataset.usdPrice);
                    const converted = (usdPrice * rate).toFixed(2);
                    el.textContent = `${symbol}${converted}`;
                }
            });

            // 2. Update specific cart totals if visible
            const cartTotal = document.getElementById('cartTotal');
            if (cartTotal) {
                // Recalculate based on cart state, not just text
                // ... handled by updateCounters actually, but we need to force re-render or handle it here
            }

            // Re-render components that might need it if simple text replacement isn't enough, 
            // but for now text replacement covers most static-ish content.
            // Future calls to renderResults will need to know the current currency.
        }

        // Override helper to format price
        function formatPrice(priceInUsd) {
            const currency = document.getElementById('currencySelector') ? document.getElementById('currencySelector').value : 'USD';
            const rate = exchangeRates[currency];
            const symbol = currencySymbols[currency];

            if (typeof priceInUsd !== 'number') return priceInUsd; // Fallback

            return `${symbol}${(priceInUsd * rate).toFixed(2)}`;
        }

        // --- End Currency Logic ---

        // --- End Logic ---

        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    selectedImageBase64 = e.target.result;

                    // Show preview
                    const previewContainer = document.getElementById('imagePreviewContainer');
                    const previewImg = document.getElementById('searchImagePreview');
                    if (previewContainer && previewImg) {
                        previewImg.src = selectedImageBase64;
                        previewContainer.classList.remove('d-none');
                    }

                    // Trigger search
                    performSearch();
                };
                reader.readAsDataURL(file);
            }
        }

        function clearSearchImage() {
            selectedImageBase64 = null;
            const previewContainer = document.getElementById('imagePreviewContainer');
            if (previewContainer) {
                previewContainer.classList.add('d-none');
            }

            // Sync AI section if present
            const aiPreview = document.getElementById('aiImagePreviewContainer');
            const aiPlaceholder = document.getElementById('aiImagePlaceholder');
            if (aiPreview && aiPlaceholder) {
                aiPreview.classList.add('d-none');
                aiPlaceholder.classList.remove('d-none');
            }

            // Trigger search again without image if there is text, or do nothing
            const query = document.getElementById('searchInput').value.trim();
            if (query) performSearch();
        }

        function handleAiImageSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    selectedImageBase64 = e.target.result;

                    // Show preview in RAG section
                    const previewContainer = document.getElementById('aiImagePreviewContainer');
                    const placeholder = document.getElementById('aiImagePlaceholder');
                    const previewImg = document.getElementById('aiImagePreview');
                    if (previewContainer && previewImg && placeholder) {
                        previewImg.src = selectedImageBase64;
                        previewContainer.classList.remove('d-none');
                        placeholder.classList.add('d-none');
                    }

                    // Sync top bar
                    const topPreview = document.getElementById('imagePreviewContainer');
                    const topImg = document.getElementById('searchImagePreview');
                    if (topPreview && topImg) {
                        topImg.src = selectedImageBase64;
                        topPreview.classList.remove('d-none');
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function clearAiImage() {
            selectedImageBase64 = null;
            const aiPreview = document.getElementById('aiImagePreviewContainer');
            const aiPlaceholder = document.getElementById('aiImagePlaceholder');
            if (aiPreview && aiPlaceholder) {
                aiPreview.classList.add('d-none');
                aiPlaceholder.classList.remove('d-none');
            }
            const aiInput = document.getElementById('aiImageInput');
            if (aiInput) aiInput.value = '';

            // Sync top bar
            const topPreview = document.getElementById('imagePreviewContainer');
            if (topPreview) topPreview.classList.add('d-none');

            const aiSearchEl = document.getElementById('aiSearchInput');
            const query = aiSearchEl ? aiSearchEl.value.trim() : '';
            if (query) performAiSearch();
        }

        async function performAiSearch() {
            const aiSearchEl = document.getElementById('aiSearchInput');
            const query = aiSearchEl ? aiSearchEl.value.trim() : '';
            // Sync with global search bar
            const searchInput = document.getElementById('searchInput');
            if (searchInput) searchInput.value = query;

            await performSearch();

            // Ensure results visible
            const resultsSection = document.getElementById('tab-1');
            if (resultsSection) resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function handleSearchClick() {
            performSearch();
        }

        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            const imageBase64 = selectedImageBase64;

            if (!query && !imageBase64) return;

            // Switch to tab-1 and show results there
            const tab1Link = document.querySelector('a[href="#tab-1"]');
            if (tab1Link) tab1Link.click();

            showLoading(true, '1');
            const grid = document.getElementById('resultsGrid-1');
            if (grid) grid.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE}/api/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_query: query || null,
                        image_base64: imageBase64 || null,
                        limit: 15
                    })
                });
                const data = await response.json();

                const answerContainer = document.getElementById('aiAnswerContainer-1');
                if (answerContainer) answerContainer.classList.add('d-none');

                if (query) {
                    try { localStorage.setItem('finfit_last_search', query); } catch (e) {}
                    trackInteraction('search', query);
                }
                if (data.results && data.results.length > 0) {
                    let title = "Search results";
                    if (query && imageBase64) title = `Multimodal results for "${query}" + Image`;
                    else if (query) title = `Search results for "${query}"`;
                    else if (imageBase64) title = "Image search results";

                    renderResults(data.results, 'resultsGrid-1', `${title} (${data.count} found)`);
                    grid.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    grid.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="fas fa-search text-muted fa-3x mb-3"></i>
                            <h4 class="text-muted">No products found</h4>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Search failed:', error);
            } finally {
                showLoading(false, '1');
            }
        }

        async function searchByImage() {
            performSearch();
        }

        function showLoading(show, tabNum = null) {
            if (tabNum) {
                // Show/hide specific tab spinner
                const spinner = document.getElementById(`loadingSpinner-${tabNum}`);
                if (spinner) spinner.style.display = show ? 'block' : 'none';
            } else {
                // Show/hide main search spinner (for search results)
                const spinner = document.getElementById('loadingSpinner-1');
                if (spinner) spinner.style.display = show ? 'block' : 'none';
            }
        }

        async function loadTab(tabId, category) {
            const tabNum = tabId.split('-')[1];
            const gridId = `resultsGrid-${tabNum}`;
            const grid = document.getElementById(gridId);
            if (!grid) return;

            // Tab 0 = Pour vous (recommandations basées sur favoris, panier, recherche)
            if (tabId === 'tab-0' || category === 'pour-vous') {
                await loadPourVousTab();
                return;
            }

            // Only reload if empty (for better UX)
            if (grid.children.length > 0) return;

            // Show loading spinner for this tab
            showLoading(true, tabNum);

            try {
                const url = category
                    ? `${API_BASE}/products?limit=12&category=${encodeURIComponent(category)}`
                    : `${API_BASE}/products?limit=12`;
                const response = await fetch(url);
                const data = await response.json();
                const products = Array.isArray(data) ? data : (data.products || []);
                renderResults(products, gridId);
            } catch (e) {
                console.error(`Failed to load tab ${tabId}:`, e);
                grid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-exclamation-triangle text-warning fa-3x mb-3"></i>
                        <h4 class="text-muted">Échec du chargement des produits</h4>
                        <p class="text-muted">Vérifiez votre connexion à Qdrant Cloud</p>
                        <button class="btn btn-primary rounded-pill" onclick="reloadTab('${tabId}', ${category ? `'${category}'` : 'null'})">
                            <i class="fas fa-sync-alt me-2"></i>Réessayer
                        </button>
                    </div>
                `;
            } finally {
                showLoading(false, tabNum);
            }
        }

        async function loadPourVousTab() {
            const gridId = 'resultsGrid-0';
            const grid = document.getElementById(gridId);
            const spinner = document.getElementById('loadingSpinner-0');
            if (!grid || !spinner) return;

            setPourVousBanner(false);
            spinner.style.display = 'block';
            grid.innerHTML = '';

            try {
                const userJson = localStorage.getItem('finfit_user');
                const user = userJson ? JSON.parse(userJson) : null;
                const email = user && user.email ? user.email : null;

                if (email) {
                    var seed = getPourVousSeedFromStorage();
                    var url = `${API_BASE}/api/recommendations?user_email=${encodeURIComponent(email)}&limit=12&_t=${Date.now()}`;
                    if (seed.productIds.length) url += '&product_ids=' + encodeURIComponent(seed.productIds.join(','));
                    if (seed.cartIds.length) url += '&cart_ids=' + encodeURIComponent(seed.cartIds.join(','));
                    if (seed.wishlistIds.length) url += '&wishlist_ids=' + encodeURIComponent(seed.wishlistIds.join(','));
                    if (seed.historyIds.length) url += '&history_ids=' + encodeURIComponent(seed.historyIds.join(','));
                    if (seed.searchQuery) url += '&search_query=' + encodeURIComponent(seed.searchQuery);
                    var response, data = {};
                    try {
                        response = await fetch(url);
                        try { data = await response.json(); } catch (_) { data = {}; }
                    } catch (err) {
                        console.warn('Recommendations API request failed:', err);
                    }
                    var products = (data.products && data.products.length) ? data.products
                        : (data.recommendations && data.recommendations.length) ? data.recommendations : [];
                    var strategy = (data.strategy || '').toLowerCase();
                    var isPersonalized = strategy.includes('by-seed') || strategy.includes('sqlite');

                    if (products.length > 0) {
                        setPourVousBanner(true, isPersonalized, data.message || '');
                        renderResults(products, gridId, null, true);
                    } else {
                        await tryPourVousBySeed(grid, gridId, false);
                        if (!grid.querySelector('.product-item') && !grid.querySelector('.col-md-6')) {
                            await loadPourVousFallbackProducts(grid, gridId);
                        }
                    }
                } else {
                    await tryPourVousBySeed(grid, gridId, true);
                    if (!grid.querySelector('.product-item') && !grid.querySelector('.col-md-6')) {
                        await loadPourVousFallbackProducts(grid, gridId);
                    }
                }
            } catch (e) {
                console.error('loadPourVousTab failed:', e);
                await renderPourVousFallback(grid, true);
            } finally {
                spinner.style.display = 'none';
            }
        }

        async function loadPourVousFallbackProducts(grid, gridId) {
            try {
                const response = await fetch(`${API_BASE}/products?limit=12&_t=${Date.now()}`);
                const data = await response.json();
                const products = Array.isArray(data) ? data : (data.products || []);
                if (products.length > 0) {
                    setPourVousBanner(true, false, 'Quelques produits — ajoutez aux favoris ou faites une recherche pour voir des recommandations personnalisées.');
                    renderResults(products, gridId, null, true);
                } else {
                    grid.innerHTML = '<div class="col-12 text-center py-5 text-muted"><p>Impossible de charger les produits pour le moment.</p><button type="button" class="btn btn-primary rounded-pill mt-2" onclick="loadTab(\'tab-0\', \'pour-vous\')">Réessayer</button></div>';
                }
            } catch (e) {
                grid.innerHTML = '<div class="col-12 text-center py-5 text-muted"><p>Impossible de charger les produits.</p><button type="button" class="btn btn-primary rounded-pill mt-2" onclick="loadTab(\'tab-0\', \'pour-vous\')">Réessayer</button></div>';
            }
        }

        function getPourVousSeedFromStorage() {
            const cartData = JSON.parse(localStorage.getItem(getCartKey()) || '[]');
            const wishlistData = JSON.parse(localStorage.getItem(getWishlistKey()) || '[]');
            const historyData = JSON.parse(localStorage.getItem(getRecommendationHistoryKey()) || '[]');
            const lastSearch = (localStorage.getItem('finfit_last_search') || '').trim();
            const cartIds = [];
            const wishlistIds = [];
            cartData.forEach(function (item) { const id = item.id || item.asin; if (id) cartIds.push(String(id)); });
            wishlistData.forEach(function (item) { const id = item.id || item.asin; if (id) wishlistIds.push(String(id)); });
            const cartSet = new Set(cartIds);
            const wishlistSet = new Set(wishlistIds);
            const historyIds = [];
            for (var h = 0; h < historyData.length && historyIds.length < 40; h++) {
                var id = historyData[h] ? String(historyData[h]) : '';
                if (id && !cartSet.has(id) && !wishlistSet.has(id)) historyIds.push(id);
            }
            var productIds = cartIds.slice();
            wishlistIds.forEach(function (id) { if (!cartSet.has(id)) productIds.push(id); });
            historyIds.forEach(function (id) { productIds.push(id); });
            return { productIds: productIds, cartIds: cartIds, wishlistIds: wishlistIds, historyIds: historyIds, searchQuery: lastSearch };
        }

        async function tryPourVousBySeed(grid, gridId, showLoginIfEmpty) {
            const seed = getPourVousSeedFromStorage();
            const hasSeed = seed.productIds.length > 0 || (seed.searchQuery && seed.searchQuery.length > 0);
            if (!hasSeed) {
                await renderPourVousFallback(grid, showLoginIfEmpty);
                return;
            }
            try {
                const params = new URLSearchParams();
                if (seed.productIds.length > 0) params.set('product_ids', seed.productIds.join(','));
                if (seed.cartIds.length > 0) params.set('cart_ids', seed.cartIds.join(','));
                if (seed.wishlistIds.length > 0) params.set('wishlist_ids', seed.wishlistIds.join(','));
                if (seed.historyIds.length > 0) params.set('history_ids', seed.historyIds.join(','));
                if (seed.searchQuery) params.set('search_query', seed.searchQuery);
                params.set('limit', '12');
                const response = await fetch(`${API_BASE}/api/recommendations/by-seed?${params.toString()}`);
                const data = await response.json();
                const products = (data.recommendations && data.recommendations.length) ? data.recommendations : [];
                if (products.length > 0) {
                    setPourVousBanner(true, true, 'Recommandations basées sur vos favoris, panier et recherche');
                    renderResults(products, gridId, null, true);
                } else {
                    await renderPourVousFallback(grid, showLoginIfEmpty);
                }
            } catch (e) {
                console.error('tryPourVousBySeed failed:', e);
                await renderPourVousFallback(grid, showLoginIfEmpty);
            }
        }

        function setPourVousBanner(show, isPersonalized, message) {
            const el = document.getElementById('pourVousBanner');
            if (!el) return;
            el.style.display = 'none';
            el.innerHTML = '';
        }

        async function renderPourVousFallback(grid, showLoginMessage = false) {
            setPourVousBanner(false);
            if (showLoginMessage) {
                grid.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-heart fa-4x text-muted mb-4"></i>
                        <h4 class="text-muted mb-3">Pour vous</h4>
                        <p class="text-muted mb-4">Connectez-vous pour voir des recommandations personnalisées basées sur vos favoris, votre panier et vos recherches.</p>
                        <a href="#loginModal" class="btn btn-primary rounded-pill px-4" data-bs-toggle="modal">
                            <i class="fas fa-sign-in-alt me-2"></i>Se connecter
                        </a>
                        <p class="mt-4 text-muted small">En attendant, voici quelques produits :</p>
                    </div>
                `;
            } else {
                grid.innerHTML = '<div class="col-12"><p class="text-muted mb-3"><i class="fas fa-info-circle me-2"></i>Connectez-vous pour des recommandations personnalisées (favoris, panier, recherche).</p></div>';
            }
            try {
                const response = await fetch(`${API_BASE}/products?limit=12`);
                const data = await response.json();
                const products = Array.isArray(data) ? data : (data.products || []);
                if (products.length > 0) {
                    setPourVousBanner(true, false, 'Suggestions générales — ajoutez aux favoris ou connectez-vous pour des recommandations personnalisées.');
                    renderedProductsCache = products;
                    const placeholderImg = '/static/img/placeholder.png';
                    grid.innerHTML = '';
                    products.forEach((product, index) => {
                        const delay = (0.1 * (index % 4)).toFixed(1);
                        const imageUrl = (product.image && product.image.trim()) || (product.image_url && product.image_url.trim()) || (product.image_urls && product.image_urls[0]) || placeholderImg;
                        const finalPrice = product.price || product.final_price || 0;
                        const title = product.name || product.title || 'Premium Product';
                        const productUrl = product.url || product.product_url || '#';
                        const category = product.category || 'Product';
                        const initialPrice = product.initial_price || product.original_price || null;
                        const isInWishlistFb = wishlist.some(function(w) { return w.name === (product.name || product.title); });
                        const heartClassFb = isInWishlistFb ? 'fas fa-heart fa-1x text-danger' : 'far fa-heart fa-1x';
                        const html = `
                            <div class="col-md-6 col-lg-4 col-xl-3">
                                <div class="product-item rounded wow fadeInUp" data-wow-delay="${delay}s">
                                    <div class="product-item-inner border rounded">
                                        <div class="product-item-inner-item" style="height: 250px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                                            <img src="${imageUrl}" class="img-fluid" alt="${title}" style="max-height: 100%; object-fit: contain;" onerror="this.onerror=null; this.src='${placeholderImg}';">
                                            ${product.discount ? `<div class="product-sale">-${parseDiscount(product.discount)}%</div>` : ''}
                                            <div class="product-details">
                                                <button class="btn btn-link text-white p-0" onclick="viewProduct(${index})"><i class="fa fa-eye fa-1x"></i></button>
                                                <button class="btn btn-link text-white p-0 ms-2 btn-wishlist-toggle" onclick="toggleWishlist(${index})" data-product-index="${index}" title="${isInWishlistFb ? 'Retirer des favoris' : 'Ajouter aux favoris'}"><i class="${heartClassFb}"></i></button>
                                                <button class="btn btn-link text-white p-0 ms-2" onclick="addToCart(${index})"><i class="fas fa-shopping-cart fa-1x"></i></button>
                                            </div>
                                        </div>
                                        <div class="text-center rounded-bottom p-4">
                                            <a href="#tab-1" data-bs-toggle="pill" onclick="loadTab('tab-1', '${category}')" class="d-block mb-1 text-muted small text-uppercase">${category}</a>
                                            <a href="${productUrl}" target="_blank" class="d-block h6 text-truncate mb-2" title="${title}">${title}</a>
                                            <div class="mb-2">
                                                <span class="text-primary fs-5 fw-bold" data-usd-price="${finalPrice}">${formatPrice(finalPrice)}</span>
                                                ${initialPrice && initialPrice > finalPrice ? `<del class="text-muted ms-2 small" data-usd-price="${initialPrice}">${formatPrice(initialPrice)}</del>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="product-item-add border border-top-0 rounded-bottom text-center p-4 pt-0">
                                        <button onclick="addToCart(${index})" class="btn btn-primary border-secondary rounded-pill py-2 px-4 mb-3">
                                            <i class="fas fa-shopping-cart me-2"></i> Add to Cart
                                        </button>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="d-flex text-primary">${generateStars(product.rating || 4.5)}</div>
                                            <div class="text-muted small">${product.review_count || 0} reviews</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        grid.insertAdjacentHTML('beforeend', html);
                    });
                    grid.insertAdjacentHTML('beforeend', '<div class="col-12 text-center mt-4"><a href="shop.html" class="btn btn-primary rounded-pill py-3 px-5">Voir plus</a></div>');
                    if (typeof WOW !== 'undefined') new WOW().init();
                } else if (!showLoginMessage) {
                    grid.innerHTML = '<div class="col-12 text-center py-5 text-muted"><p>Quelques produits vont se charger…</p></div>';
                    setTimeout(function () { loadPourVousFallbackProducts(grid, 'resultsGrid-0'); }, 100);
                }
            } catch (e) {
                if (!showLoginMessage && grid.innerHTML.indexOf('Connectez-vous') === -1) grid.innerHTML = '<div class="col-12 text-center py-5 text-muted">Chargement des produits...</div>';
            }
        }

        function renderMiniProduct(product) {
            const imageUrl = product.image || (product.image_urls && product.image_urls[0]) || '/static/img/placeholder.png';
            const finalPrice = product.price || product.final_price || 0;
            const title = (product.name || product.title || 'Premium Product').substring(0, 40) + ((product.name && product.name.length > 40) ? '...' : '');
            const productUrl = product.url || product.product_url || '#';
            const category = product.category || 'Product';
            const initialPrice = product.initial_price || product.original_price || null;

            return `
                <div class="productImg-item products-mini-item border">
                    <div class="row g-0">
                        <div class="col-5">
                            <div class="products-mini-img border-end h-100">
                                <img src="${imageUrl}" class="img-fluid w-100 h-100" alt="${title}" style="object-fit: contain; background: white;" onerror="this.src='/static/img/placeholder.png'">
                                <div class="products-mini-icon rounded-circle bg-primary">
                                    <a href="${productUrl}" target="_blank"><i class="fa fa-eye fa-1x text-white"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="products-mini-content p-3">
                                <a href="#tab-1" data-bs-toggle="pill" onclick="loadTab('tab-1', '${category}')" class="d-block mb-2 text-muted small text-uppercase">${category}</a>
                                <a href="${productUrl}" target="_blank" class="d-block h6 mb-2" title="${title}">${title}</a>
                                <div class="d-flex align-items-center">
                                    <span class="text-primary fs-6 fw-bold">$${typeof finalPrice === 'number' ? finalPrice.toFixed(2) : finalPrice}</span>
                                    ${initialPrice && initialPrice > finalPrice ? `<del class="text-muted ms-2 small">$${typeof initialPrice === 'number' ? initialPrice.toFixed(2) : initialPrice}</del>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="products-mini-add border p-3">
                        <a href="${productUrl}" target="_blank" class="btn btn-primary border-secondary rounded-pill py-2 px-4"><i
                                class="fas fa-shopping-cart me-2"></i> Shop Now</a>
                        <div class="d-flex">
                            <a href="#" class="text-primary d-flex align-items-center justify-content-center me-3"><span class="rounded-circle btn-sm-square border"><i class="fas fa-random"></i></span></a>
                            <a href="#" class="text-primary d-flex align-items-center justify-content-center me-0"><span class="rounded-circle btn-sm-square border"><i class="fas fa-heart"></i></span></a>
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadProductListCarousel() {
            const container = document.getElementById('productListCarousel');
            if (!container) return;
            try {
                // Fetch more to allow for random selection
                const response = await fetch(`${API_BASE}/products?limit=50`);
                let data = await response.json();
                let products = Array.isArray(data) ? data : (data.products || []);

                // Shuffle and pick 12
                products = products.sort(() => Math.random() - 0.5).slice(0, 12);

                // Destroy owl carousel if it was inited
                if (typeof $ !== 'undefined' && $.fn.owlCarousel) {
                    try { $(container).owlCarousel('destroy'); } catch (e) { }
                }

                // Group products by 4
                const groups = [];
                for (let i = 0; i < products.length; i += 4) {
                    groups.push(products.slice(i, i + 4));
                }

                container.innerHTML = groups.map(group => `
                    <div class="productImg-carousel owl-carousel productList-item">
                        ${group.map(p => renderMiniProduct(p)).join('')}
                    </div>
                `).join('');

                // Re-init Owl Carousels
                if (typeof $ !== 'undefined' && $.fn.owlCarousel) {
                    $(container).find('.productImg-carousel').owlCarousel({
                        autoplay: true,
                        smartSpeed: 1500,
                        dots: false,
                        loop: true,
                        items: 1,
                        margin: 25,
                        nav: true,
                        navText: ['<i class="bi bi-arrow-left"></i>', '<i class="bi bi-arrow-right"></i>']
                    });

                    $(container).owlCarousel({
                        autoplay: true,
                        smartSpeed: 2000,
                        dots: false,
                        loop: true,
                        margin: 25,
                        nav: true,
                        navText: ['<i class="fas fa-chevron-left"></i>', '<i class="fas fa-chevron-right"></i>'],
                        responsive: {
                            0: { items: 1 },
                            576: { items: 1 },
                            768: { items: 2 },
                            992: { items: 2 },
                            1200: { items: 3 }
                        }
                    });
                }
            } catch (e) { console.error('loadProductListCarousel failed:', e); }
        }

        async function loadBestsellers() {
            const container = document.getElementById('bestsellersContainer');
            if (!container) return;
            try {
                // Fetch a good amount and sort by rating
                const response = await fetch(`${API_BASE}/products?limit=100`);
                let data = await response.json();
                let products = Array.isArray(data) ? data : (data.products || []);

                // Sort by rating (high to low) and pick top 6
                products = products
                    .filter(p => p.rating) // Only those with ratings
                    .sort((a, b) => (b.rating || 0) - (a.rating || 0))
                    .slice(0, 6);

                // If no ratings, just pick random 6
                if (products.length < 6) {
                    const response2 = await fetch(`${API_BASE}/products?limit=50`);
                    const data2 = await response2.json();
                    const all = Array.isArray(data2) ? data2 : (data2.products || []);
                    products = all.sort(() => Math.random() - 0.5).slice(0, 6);
                }

                container.innerHTML = products.map((p, i) => {
                    const delay = (0.1 * (i % 3)).toFixed(1);
                    return `<div class="col-md-6 col-lg-6 col-xl-4 wow fadeInUp" data-wow-delay="${delay}s">${renderMiniProduct(p)}</div>`;
                }).join('');
                if (typeof WOW !== 'undefined') new WOW().init();
            } catch (e) { console.error('loadBestsellers failed:', e); }
        }

        async function loadDynamicBanners() {
            const container = document.getElementById('bannerContainer');
            if (!container) return;
            try {
                const response = await fetch(`${API_BASE}/products?limit=50`);
                const data = await response.json();
                const products = Array.isArray(data) ? data : (data.products || []);
                // Pick random 2 products with images
                const selected = products
                    .filter(p => p.image)
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 2);
                if (selected.length < 2) return;

                container.innerHTML = selected.map((p, i) => {
                    const animation = i === 0 ? 'fadeInLeft' : 'fadeInRight';
                    const delay = (0.1 * (i + 1)).toFixed(1);
                    const img = p.image || '/static/img/placeholder.png';
                    const title = (p.name || 'Premium Product').substring(0, 40);
                    const price = p.price || 0;
                    const url = p.url || '#';
                    const bgOverlay = i === 0 ? 'rgba(255, 255, 255, 0.6)' : 'rgba(83, 160, 236, 0.6)';
                    const textClass = i === 0 ? 'text-primary' : 'text-white';

                    return `
                        <div class="col-lg-6 wow ${animation}" data-wow-delay="${delay}s">
                            <a href="${url}" target="_blank" style="text-decoration: none;">
                                <div class="bg-primary rounded position-relative" style="overflow: hidden;">
                                    <img src="${img}" class="img-fluid w-100 rounded" alt="${title}" style="height: 380px; object-fit: cover; background: white;">
                                    <div class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center rounded p-4"
                                        style="background: ${bgOverlay};">
                                <h3 class="display-5 ${textClass}">${title}</h3>
                                <p class="fs-4 ${i === 0 ? 'text-muted' : 'text-white'}" data-usd-price="${price}">${formatPrice(price)}</p>
                                <a class="btn ${i === 0 ? 'btn-primary' : 'btn-secondary'} rounded-pill align-self-start py-2 px-4" href="${url}" target="_blank">Shop Now</a>
                                    </div>
                                </div>
                            </a>
                        </div>
                    `;
                }).join('');
            } catch (e) { console.error('loadDynamicBanners failed:', e); }
        }

        function reloadTab(tabId, category) {
            const tabNum = tabId.split('-')[1];
            const gridId = `resultsGrid-${tabNum}`;
            const grid = document.getElementById(gridId);
            if (grid) grid.innerHTML = ''; // Clear to force reload
            loadTab(tabId, category);
        }

        function clearSearch() {
            // Clear the search input
            document.getElementById('searchInput').value = '';
            const aiSearchEl = document.getElementById('aiSearchInput');
            if (aiSearchEl) aiSearchEl.value = '';
            clearSearchImage();

            // Clear AI answer
            const answerContainer = document.getElementById('aiAnswerContainer-1');
            if (answerContainer) answerContainer.classList.add('d-none');

            // Clear the results grid and reload all products
            const grid = document.getElementById('resultsGrid-1');
            if (grid) grid.innerHTML = '';
            loadTab('tab-1', null);
        }

        function parseDiscount(discountValue) {
            if (!discountValue) return null;
            // Extract number from discount string like "-32%", "32%", "-32", "32"
            const match = String(discountValue).match(/(\d+)/);
            return match ? parseInt(match[1]) : null;
        }

        function renderResults(products, gridId, headerMessage = null, showWhyRecommended = false) {
            const grid = document.getElementById(gridId);
            if (!grid) return;
            grid.innerHTML = '';

            // Add header message if provided (for search results)
            if (headerMessage) {
                grid.insertAdjacentHTML('beforeend', `
                    <div class="col-12 mb-3">
                        <div class="alert alert-info d-flex align-items-center" role="alert">
                            <i class="fas fa-info-circle me-2"></i>
                            <span>${headerMessage}</span>
                            <button type="button" class="btn btn-sm btn-outline-primary ms-auto rounded-pill" onclick="clearSearch()">
                                <i class="fas fa-times me-1"></i>Clear Search
                            </button>
                        </div>
                    </div>
                `);
            }

            if (!products || products.length === 0) {
                grid.innerHTML = '<div class="col-12 text-center py-5"><h3 class="text-muted">No products found.</h3></div>';
                return;
            }

            renderedProductsCache = products;
            const placeholderImg = '/static/img/placeholder.png';

            products.forEach((product, index) => {
                const delay = (0.1 * (index % 4)).toFixed(1);
                const imageUrl = (product.image && product.image.trim()) || (product.image_url && product.image_url.trim()) || (product.image_urls && product.image_urls[0]) || placeholderImg;
                const finalPrice = product.price || product.final_price || 0;
                const title = product.name || product.title || 'Premium Product';
                const productUrl = product.url || product.product_url || '#';
                const category = product.category || 'Product';
                const initialPrice = product.initial_price || product.original_price || null;
                const whyText = showWhyRecommended && (product.explanation || product.recommendation_reason) ? (product.explanation || product.recommendation_reason) : '';
                const isInWishlist = wishlist.some(function(w) { return w.name === (product.name || product.title); });
                const heartClass = isInWishlist ? 'fas fa-heart fa-1x text-danger' : 'far fa-heart fa-1x';

                const html = `
                    <div class="col-md-6 col-lg-4 col-xl-3">
                        <div class="product-item rounded wow fadeInUp" data-wow-delay="${delay}s">
                            <div class="product-item-inner border rounded">
                                <div class="product-item-inner-item" style="height: 250px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                                    <img src="${imageUrl}" class="img-fluid" alt="${title}" style="max-height: 100%; object-fit: contain;" onerror="this.onerror=null; this.src='${placeholderImg}';">
                                    ${product.discount ? `<div class="product-sale">-${parseDiscount(product.discount)}%</div>` : ''}
                                    <div class="product-details">
                                        <button class="btn btn-link text-white p-0" onclick="viewProduct(${index})"><i class="fa fa-eye fa-1x"></i></button>
                                        <button class="btn btn-link text-white p-0 ms-2 btn-wishlist-toggle" onclick="toggleWishlist(${index})" data-product-index="${index}" title="${isInWishlist ? 'Retirer des favoris' : 'Ajouter aux favoris'}"><i class="${heartClass}"></i></button>
                                        <button class="btn btn-link text-white p-0 ms-2" onclick="addToCart(${index})"><i class="fas fa-shopping-cart fa-1x"></i></button>
                                    </div>
                                </div>
                                <div class="text-center rounded-bottom p-4">
                                    <a href="#tab-1" data-bs-toggle="pill" onclick="loadTab('tab-1', '${category}')" class="d-block mb-1 text-muted small text-uppercase">${category}</a>
                                    <a href="${productUrl}" target="_blank" class="d-block h6 text-truncate mb-2" title="${title}">${title}</a>
                                    <div class="mb-2">
                                        <span class="text-primary fs-5 fw-bold" data-usd-price="${finalPrice}">${formatPrice(finalPrice)}</span>
                                        ${initialPrice && initialPrice > finalPrice ? `<del class="text-muted ms-2 small" data-usd-price="${initialPrice}">${formatPrice(initialPrice)}</del>` : ''}
                                    </div>
                                    ${whyText ? `<p class="small text-muted mb-0 mt-1"><i class="fas fa-lightbulb text-warning me-1"></i> ${whyText}</p>` : ''}
                                </div>
                            </div>
                            <div class="product-item-add border border-top-0 rounded-bottom text-center p-4 pt-0">
                                <button onclick="addToCart(${index})" class="btn btn-primary border-secondary rounded-pill py-2 px-4 mb-3">
                                    <i class="fas fa-shopping-cart me-2"></i> Add to Cart
                                </button>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex text-primary">
                                        ${generateStars(product.rating || 4.5)}
                                    </div>
                                    <div class="text-muted small">${product.score ? `Match: ${(product.score * 100).toFixed(0)}%` : `${product.review_count || 0} reviews`}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                grid.insertAdjacentHTML('beforeend', html);
            });

            // Add "Show More" button pointing to Shop page
            grid.insertAdjacentHTML('beforeend', `
                <div class="col-12 text-center mt-4 wow fadeInUp" data-wow-delay="0.5s">
                    <a href="shop.html" class="btn btn-primary rounded-pill py-3 px-5">Show More</a>
                </div>
            `);

            // Re-initialize WOW animations for new elements
            if (typeof WOW !== 'undefined') {
                new WOW().init();
            }
        }

        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= Math.floor(rating)) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i === Math.ceil(rating) && rating % 1 !== 0) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            return stars;
        }

        async function loadCarouselProducts() {
            const container = document.getElementById('headerCarousel') || document.querySelector('.header-carousel');
            if (!container) return;

            try {
                const response = await fetch(`${API_BASE}/products?limit=50`);
                const data = await response.json();
                const products = Array.isArray(data) ? data : (data.products || []);

                // Keep products with images OR fallback if none have images
                let withImages = products.filter(p => p.image || (p.image_urls && p.image_urls[0]));
                if (withImages.length === 0 && products.length > 0) {
                    withImages = products; // Fallback to all products
                }

                // Shuffle and pick 2 random
                const shuffled = withImages.sort(() => Math.random() - 0.5);
                const selected = shuffled.slice(0, 2);

                if (selected.length === 0) {
                    // Empty state - show something default
                    // Destroy owl carousel if it was inited by main.js
                    if (typeof $ !== 'undefined' && $.fn.owlCarousel) {
                        try { $(container).owlCarousel('destroy'); } catch (e) { }
                    }
                    container.innerHTML = `
                        <div class="row g-0 header-carousel-item align-items-center">
                            <div class="col-xl-6 carousel-img wow fadeInLeft" data-wow-delay="0.1s">
                                <img src="/static/img/header-img.jpg" class="img-fluid w-100" alt="Context" style="object-fit: contain; max-height: 320px;">
                            </div>
                            <div class="col-xl-6 carousel-content p-4">
                                <h4 class="text-uppercase fw-bold mb-4 wow fadeInRight" data-wow-delay="0.1s" style="letter-spacing: 3px;">Welcome to FinFit</h4>
                                <h1 class="display-3 text-capitalize mb-4 wow fadeInRight" data-wow-delay="0.3s">Amazing Products</h1>
                                <a class="btn btn-primary rounded-pill py-3 px-5 wow fadeInRight" data-wow-delay="0.7s" href="shop.html">Browse Shop</a>
                            </div>
                        </div>`;
                    // Re-init simple
                    if (typeof $ !== 'undefined' && $.fn.owlCarousel) {
                        $(container).owlCarousel({
                            items: 1,
                            autoplay: true,
                            smartSpeed: 2000,
                            dots: false,
                            loop: true,
                            nav: false
                        });
                    }
                    return;
                }

                // Destroy owl carousel if it was inited by main.js
                if (typeof $ !== 'undefined' && $.fn.owlCarousel) {
                    try { $(container).owlCarousel('destroy'); } catch (e) { }
                }

                container.innerHTML = selected.map(p => {
                    const img = p.image || (p.image_urls && p.image_urls[0]) || '/static/img/placeholder.png';
                    const name = (p.name || 'Product').substring(0, 55) + ((p.name && p.name.length > 55) ? '...' : '');
                    const cat = p.category || 'Product';
                    const url = p.url || '#';
                    let saveText = 'Special Offer';
                    if (p.discount) {
                        const m = String(p.discount).match(/(\d+)/);
                        saveText = m ? `Save Up To ${m[1]}%` : `Save ${p.discount}`;
                    } else if (p.initial_price && p.price && p.initial_price > p.price) {
                        const s = (p.initial_price - p.price).toFixed(2);
                        saveText = `Save $${s}`;
                    }
                    return `
                        <div class="row g-0 header-carousel-item align-items-center">
                            <div class="col-xl-6 carousel-img wow fadeInLeft" data-wow-delay="0.1s">
                                <img src="${img}" class="img-fluid w-100" alt="${name}" style="object-fit: contain; max-height: 320px;" onerror="this.src='/static/img/placeholder.png'">
                            </div>
                            <div class="col-xl-6 carousel-content p-4">
                                <h4 class="text-uppercase fw-bold mb-4 wow fadeInRight" data-wow-delay="0.1s" style="letter-spacing: 3px;">${saveText}</h4>
                                <h1 class="display-3 text-capitalize mb-4 wow fadeInRight" data-wow-delay="0.3s">${name}</h1>
                                <p class="text-dark wow fadeInRight" data-wow-delay="0.5s">${cat}</p>
                                <a class="btn btn-primary rounded-pill py-3 px-5 wow fadeInRight" data-wow-delay="0.7s" href="${url}" target="_blank">Shop Now</a>
                            </div>
                        </div>
                    `;
                }).join('');

                // Re-init owl carousel
                if (typeof $ !== 'undefined' && $.fn.owlCarousel) {
                    $(container).owlCarousel({
                        items: 1,
                        autoplay: true,
                        smartSpeed: 2000,
                        center: false,
                        dots: false,
                        loop: true,
                        margin: 0,
                        nav: true,
                        navText: ['<i class="bi bi-arrow-left"></i>', '<i class="bi bi-arrow-right"></i>']
                    });
                }
                if (typeof WOW !== 'undefined') new WOW().init();
            } catch (e) {
                console.error('loadCarouselProducts failed:', e);
            }
        }

        async function loadFeaturedOffers() {
            const container = document.getElementById('productsOfferContainer');
            if (!container) return;

            try {
                let productsWithDiscounts = [];
                const userJson = localStorage.getItem('finfit_user');
                const user = userJson ? JSON.parse(userJson) : null;

                if (user && user.email) {
                    // Try to get personalized recommendations
                    console.log('Fetching personalized recommendations for', user.email);
                    const recResponse = await fetch(`${API_BASE}/api/recommendations?user_email=${encodeURIComponent(user.email)}&limit=2`);
                    const recData = await recResponse.json();
                    if (recData.success && recData.products && recData.products.length > 0) {
                        productsWithDiscounts = recData.products.map(p => ({
                            ...p,
                            isPersonalized: true,
                            discountPercent: Math.floor(Math.random() * 20) + 10 // Mock discount for UI consistency
                        }));
                    }
                }

                if (productsWithDiscounts.length === 0) {
                    // Fallback to top discounts if no recommendations
                    const response = await fetch(`${API_BASE}/products?limit=50`);
                    const data = await response.json();
                    const products = Array.isArray(data) ? data : (data.products || []);

                    productsWithDiscounts = products
                        .filter(p => {
                            const discount = p.discount || (p.initial_price && p.price && p.initial_price > p.price);
                            return discount && p.image;
                        })
                        .map(p => {
                            let discountPercent = 0;
                            if (p.discount) {
                                const match = p.discount.toString().match(/(\d+)/);
                                discountPercent = match ? parseInt(match[1]) : 0;
                            } else if (p.initial_price && p.price && p.initial_price > p.price) {
                                discountPercent = Math.round(((p.initial_price - p.price) / p.initial_price) * 100);
                            }
                            return { ...p, discountPercent };
                        })
                        .sort((a, b) => b.discountPercent - a.discountPercent)
                        .slice(0, 2);

                    if (productsWithDiscounts.length < 2) {
                        const regularProducts = products
                            .filter(p => p.image && !productsWithDiscounts.find(po => po.id === p.id))
                            .slice(0, 2 - productsWithDiscounts.length);
                        productsWithDiscounts.push(...regularProducts);
                    }
                }

                // Render the offers
                container.innerHTML = '';
                productsWithDiscounts.forEach((product, index) => {
                    const discountPercent = product.discountPercent || 0;
                    const category = product.category || 'Product';
                    const productName = (product.name || 'Premium Product').substring(0, 30) + (product.name && product.name.length > 30 ? '...' : '');
                    const imageUrl = product.image || (product.image_urls && product.image_urls[0]) || '/static/img/placeholder.png';
                    const productUrl = product.url || '#';

                    const delay = index === 0 ? '0.2s' : '0.3s';
                    const animation = index === 0 ? 'fadeInLeft' : 'fadeInRight';

                    const offerHtml = `
                        <div class="col-lg-6 wow ${animation}" data-wow-delay="${delay}">
                            <a href="${productUrl}" target="_blank" class="d-flex align-items-center justify-content-between border bg-white rounded p-4" style="text-decoration: none;">
                                <div>
                                    <p class="text-muted mb-3">${product.isPersonalized ? 'Recommended for You - Based on Your Interests' : `Find The Best ${category} for You!`}</p>
                                    <h3 class="text-primary">${productName}</h3>
                                    <h1 class="display-3 text-secondary mb-0">${discountPercent}% <span class="text-primary fw-normal">Off</span></h1>
                                </div>
                                <img src="${imageUrl}" class="img-fluid" alt="${productName}" style="max-height: 150px; object-fit: contain;" onerror="this.src='/static/img/placeholder.png'">
                            </a>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', offerHtml);
                });

                // Re-initialize WOW animations
                if (typeof WOW !== 'undefined') {
                    new WOW().init();
                }
            } catch (error) {
                console.error('Failed to load featured offers:', error);
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <p class="text-muted">Featured offers will appear here</p>
                    </div>
                `;
            }
        }

        // Chatbot Functions
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            if (!chatWindow) return;
            chatWindow.classList.toggle('active');
            if (chatWindow.classList.contains('active')) {
                const input = document.getElementById('chatInput');
                if (input) input.focus();
            }
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const chatBody = document.getElementById('chatBody');
            if (!input || !chatBody) return;
            const message = (input.value || '').trim();

            if (!message && !selectedChatImageBase64) return;

            // Add User Message (image + text, both in conversation)
            const userMsgDiv = document.createElement('div');
            userMsgDiv.className = 'chat-message message-user';
            let userContent = '';
            if (selectedChatImageBase64) {
                userContent += '<div class="chat-user-image mb-2"><img src="' + selectedChatImageBase64 + '" alt="Uploaded" style="max-width: 120px; max-height: 120px; border-radius: 8px; object-fit: contain; border: 1px solid rgba(0,0,0,0.1);"></div>';
            }
            if (message) {
                const safe = String(message).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
                userContent += '<div class="chat-user-text">' + safe + '</div>';
            }
            userMsgDiv.innerHTML = userContent || '<span class="text-muted">(image)</span>';
            chatBody.appendChild(userMsgDiv);

            // Clear Input
            input.value = '';

            // Add Loading Indicator
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'chat-message message-ai loading';
            loadingDiv.innerHTML = '<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> Thinking...';
            loadingDiv.id = 'ai-loading';
            chatBody.appendChild(loadingDiv);

            // Scroll to bottom
            chatBody.scrollTop = chatBody.scrollHeight;

            const currency = document.getElementById('currencySelector') ? document.getElementById('currencySelector').value : 'USD';

            try {
                const response = await fetch(`${API_BASE}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        image_base64: selectedChatImageBase64 || null,
                        currency: currency
                    })
                });

                if (!response.ok) {
                    let errDetail = '';
                    try {
                        const errBody = await response.json();
                        if (errBody && typeof errBody.detail === 'string') errDetail = errBody.detail;
                    } catch (_) {}
                    throw new Error(errDetail || `HTTP error ${response.status}`);
                }

                const data = await response.json();

                const loader = document.getElementById('ai-loading');
                if (loader) loader.remove();

                const aiMsgDiv = document.createElement('div');
                aiMsgDiv.className = 'chat-message message-ai';
                const answerText = (data.answer ?? data.response ?? '').toString();
                let contentHtml = answerText.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');

                const productsList = Array.isArray(data.products) ? data.products : (data.results || []);
                if (productsList.length > 0) {
                    contentHtml += `<div class="product-results">`;
                    productsList.forEach(p => {
                        const img = (p.image_url && p.image_url.trim()) || (p.image && p.image.trim()) || (p.image_urls && p.image_urls[0]) || '/static/img/placeholder.png';
                        // Convert price using our frontend helper
                        const priceDisplay = p.price_usd ? formatPrice(p.price_usd) : p.price;

                        contentHtml += `
                        <div class="product-card" onclick="window.open('${p.url || '#'}', '_blank')">
                            <img src="${img}" onerror="this.src='/static/img/placeholder.png'">
                            <div class="product-info">
                                <div class="product-name">${p.name}</div>
                                <div class="product-meta">
                                    <span class="product-price" data-usd-price="${p.price_usd}">${priceDisplay}</span> • <span class="product-availability">${p.availability || 'In Stock'}</span>
                                </div>
                            </div>
                        </div>`;
                    });
                    contentHtml += `</div>`;
                }

                aiMsgDiv.innerHTML = contentHtml;
                chatBody.appendChild(aiMsgDiv);
                chatBody.scrollTop = chatBody.scrollHeight;

                // Clear the image after successful send
                clearChatImage();
            } catch (error) {
                console.error('Chat error:', error);
                const loader = document.getElementById('ai-loading');
                if (loader) loader.remove();
                const errorDiv = document.createElement('div');
                errorDiv.className = 'chat-message message-ai text-danger';
                errorDiv.textContent = (error && error.message && !error.message.startsWith('HTTP error')) ? error.message : "Oops! I hit a snag. Please check your connection.";
                chatBody.appendChild(errorDiv);
            }
        }

        async function updateAuthUI() {
            const token = localStorage.getItem('finfit_token');
            const storedUser = localStorage.getItem('finfit_user');
            const loginLink = document.getElementById('loginLink');
            const userMenu = document.getElementById('userMenu');
            const userNameDisplay = document.getElementById('userNameDisplay');

            if (token) {
                // User is logged in
                if (loginLink) loginLink.style.setProperty('display', 'none', 'important');
                if (userMenu) userMenu.style.setProperty('display', 'block', 'important');

                // Use stored user info if available
                if (userNameDisplay) {
                    if (storedUser) {
                        try {
                            const userData = JSON.parse(storedUser);
                            userNameDisplay.textContent = userData.name || "User";
                        } catch (e) {
                            userNameDisplay.textContent = "Admin User";
                        }
                    } else {
                        userNameDisplay.textContent = "Admin User";
                    }
                }
            } else {
                // User is logged out
                if (loginLink) loginLink.style.setProperty('display', 'block', 'important');
                if (userMenu) userMenu.style.setProperty('display', 'none', 'important');
            }
        }

        // Logout handler
        document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('finfit_token');
                    localStorage.removeItem('finfit_user');
                    updateAuthUI();
                    window.location.reload();
                });
            }
        });

        async function init() {
            console.log('🚀 Initializing FinFit - Loading everything from Qdrant Cloud...');

            // Re-init the existing functions and our new ones
            await Promise.all([
                loadTab('tab-0', 'pour-vous'),
                loadTab('tab-1', null),
                loadTab('tab-2', 'Electronics'),
                loadTab('tab-3', 'Fashion'),
                loadTab('tab-4', 'Decoration'),
                loadCarouselProducts(),
                loadFeaturedOffers(),
                loadDynamicBanners(),
                loadProductListCarousel(),
                loadBestsellers()
            ]);
            if (typeof loadRecommendations === 'function') loadRecommendations();

            // **SESSION SYNC LOGIC START**
            // Check for token in URL (passed from dashboard)
            const urlParams = new URLSearchParams(window.location.search);
            const tokenFromUrl = urlParams.get('token');
            if (tokenFromUrl) {
                console.log('🔄 Syncing session from Dashboard...');
                localStorage.setItem('finfit_token', tokenFromUrl);
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }

            // Always update UI on init
            await updateAuthUI();
            // **SESSION SYNC LOGIC END**

            console.log('✅ All dynamic content loaded from Qdrant Cloud!');
        }

        // Initialize when page loads
        window.onload = init;
    </script>
</body>

</html>